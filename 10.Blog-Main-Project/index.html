<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>jQuery Mini Blog Viewer</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #f4f4f4;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    #app {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    #loadPostsBtn {
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      background: #3498db;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    #loadPostsBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #loadPostsBtn:hover:not(:disabled) {
      background: #2980b9;
    }

    #status {
      font-size: 14px;
      color: #555;
    }

    #container {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }

    #postList {
      width: 40%;
      max-height: 430px;
      overflow-y: auto;
      border-right: 1px solid #eee;
      padding-right: 10px;
    }

    .post-item {
      padding: 10px;
      margin-bottom: 8px;
      background: #f9f9f9;
      border-radius: 4px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: 0.2s;
    }

    .post-item:hover {
      background: #eef6ff;
      border-left-color: #3498db;
    }

    .post-item.active {
      background: #d6ebff;
      border-left-color: #1f78c1;
    }

    #postDetail {
      width: 60%;
      min-height: 200px;
      padding: 10px;
    }

    #postTitle {
      font-size: 20px;
      margin-bottom: 8px;
    }

    #postBody {
      margin-bottom: 15px;
    }

    #commentsToggleBtn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background: #2ecc71;
      color: #fff;
      cursor: pointer;
      font-size: 13px;
      margin-bottom: 8px;
      display: none; /* shown after a post is loaded */
    }

    #commentsToggleBtn:hover {
      background: #27ae60;
    }

    #commentsSection {
      display: none;
      margin-top: 10px;
      border-top: 1px solid #eee;
      padding-top: 8px;
    }

    .comment {
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px dashed #ddd;
    }

    .comment-email {
      font-size: 12px;
      color: #888;
    }

    #errorMsg {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    .fade-highlight {
      animation: fadeHighlight 1s ease-out;
    }

    @keyframes fadeHighlight {
      from { background-color: #fff3c4; }
      to { background-color: transparent; }
    }
  </style>

  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

  <h1>Mini Blog Viewer using jQuery </h1>

  <div id="app">
    <div id="top-bar">
      <button id="loadPostsBtn">Load Posts</button>
      <span id="status"></span>
    </div>

    <div id="errorMsg"></div>

    <div id="container">
      <div id="postList">
        <!-- Posts will be added here -->
      </div>

      <div id="postDetail">
        <h2 id="postTitle">Select a post to view details</h2>
        <p id="postBody"></p>

        <button id="commentsToggleBtn">Show Comments</button>

        <div id="commentsSection">
          <h3>Comments</h3>
          <div id="commentsList">
            <!-- Comments go here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {

      let currentPostId = null;
      let commentsLoaded = false;

      // =========================
      // Load Posts (AJAX + DOM)
      // =========================
      $("#loadPostsBtn").click(function () {
        $("#errorMsg").text("");
        $("#status").text("Loading posts...");
        $("#postList").empty();
        $("#postTitle").text("Select a post to view details");
        $("#postBody").text("");
        $("#commentsSection").hide();
        $("#commentsToggleBtn").hide();
        commentsLoaded = false;
        currentPostId = null;

        $.ajax({
          url: "https://jsonplaceholder.typicode.com/posts",
          method: "GET",
          dataType: "json",

          beforeSend: function () {
            $("#loadPostsBtn").prop("disabled", true);
          },

          success: function (data) {
            // Limit posts for UI (e.g., first 10)
            const posts = data.slice(0, 10);

            posts.forEach(function (post) {
              const item = $(`
                <div class="post-item" data-id="${post.id}">
                  <strong>#${post.id}</strong> - ${post.title}
                </div>
              `);

              $("#postList").append(item.hide().fadeIn(150));
            });

            $("#status").text("✅ Posts loaded. Click a post to view details.");
          },

          error: function (xhr, status, error) {
            $("#errorMsg").text("❌ Failed to load posts: " + status + " - " + error);
            $("#status").text("");
          },

          complete: function () {
            $("#loadPostsBtn").prop("disabled", false);
          }
        });
      });

      // =========================================
      // Click on a post (Event Handling + AJAX)
      // =========================================
      $(document).on("click", ".post-item", function () {
        const postId = $(this).data("id");
        currentPostId = postId;
        commentsLoaded = false;

        // UI: active class
        $(".post-item").removeClass("active");
        $(this).addClass("active fade-highlight");

        $("#commentsSection").slideUp(200);
        $("#commentsToggleBtn").hide();

        $("#status").text("Loading post details...");
        $("#errorMsg").text("");

        // Load single post details
        $.ajax({
          url: "https://jsonplaceholder.typicode.com/posts/" + postId,
          method: "GET",
          dataType: "json",
          success: function (post) {
            $("#postTitle").hide().text(post.title).fadeIn(300);
            $("#postBody").hide().text(post.body).fadeIn(300);
            $("#status").text("✅ Post loaded. You can view comments.");
            $("#commentsList").empty();
            $("#commentsToggleBtn").text("Show Comments").fadeIn(200);
          },
          error: function (xhr, status, error) {
            $("#errorMsg").text("❌ Failed to load post: " + status + " - " + error);
            $("#status").text("");
          }
        });

      });

      // ======================================
      // Show / Hide Comments (Event + AJAX)
      // ======================================
      $("#commentsToggleBtn").click(function () {
        if (!currentPostId) return;

        // If comments not loaded yet → load via AJAX
        if (!commentsLoaded) {
          $("#status").text("Loading comments...");
          $("#commentsList").empty();

          $.ajax({
            url: "https://jsonplaceholder.typicode.com/comments",
            method: "GET",
            dataType: "json",
            data: { postId: currentPostId }, // filter by postId
            success: function (comments) {
              comments.forEach(function (c) {
                const commentEl = $(`
                  <div class="comment">
                    <div><strong>${c.name}</strong></div>
                    <div class="comment-email">${c.email}</div>
                    <div>${c.body}</div>
                  </div>
                `);
                $("#commentsList").append(commentEl.hide().slideDown(150));
              });

              commentsLoaded = true;
              $("#commentsSection").slideDown(200);
              $("#commentsToggleBtn").text("Hide Comments");
              $("#status").text("✅ Comments loaded.");
            },
            error: function (xhr, status, error) {
              $("#errorMsg").text("❌ Failed to load comments: " + status + " - " + error);
              $("#status").text("");
            }
          });

        } else {
          // Comments already loaded → just toggle
          if ($("#commentsSection").is(":visible")) {
            $("#commentsSection").slideUp(200);
            $("#commentsToggleBtn").text("Show Comments");
          } else {
            $("#commentsSection").slideDown(200);
            $("#commentsToggleBtn").text("Hide Comments");
          }
        }
      });

    });
  </script>
</body>
</html>